# Mock responses for HITL operator testing
# Use with: MOCK_RESPONSES_FILE=tests/mocks/hitl-mocks.yaml DRY_RUN_MODE=true

run_sql:
  # SUCCESS: Agent discovered HITLAsyncGate (new in Airflow 3.1, not in training data)
  # This operator was added after Claude's training cutoff - can ONLY be found via docs
  - pattern: "HITLAsyncGate"
    response: |
      shape: (6, 4)
      | OPERATOR | DEPLOYMENT_COUNT | ORG_COUNT | TASK_RUN_COUNT |
      |----------|------------------|-----------|----------------|
      | HITLOperator | 15 | 8 | 1250 |
      | HITLBranchOperator | 10 | 5 | 890 |
      | HITLEntryOperator | 8 | 4 | 560 |
      | ApprovalOperator | 12 | 7 | 980 |
      | ApprovalSensor | 6 | 3 | 340 |
      | HITLAsyncGate | 4 | 2 | 120 |
      [SUCCESS: Found HITLAsyncGate - agent discovered NEW operator from docs!]

  # Old pattern - ApprovalOperator without HITLAsyncGate means incomplete discovery
  - pattern: "ApprovalOperator"
    response: |
      shape: (5, 4)
      | OPERATOR | DEPLOYMENT_COUNT | ORG_COUNT | TASK_RUN_COUNT |
      |----------|------------------|-----------|----------------|
      | HITLOperator | 15 | 8 | 1250 |
      | HITLBranchOperator | 10 | 5 | 890 |
      | HITLEntryOperator | 8 | 4 | 560 |
      | ApprovalOperator | 12 | 7 | 980 |
      | ApprovalSensor | 6 | 3 | 340 |
      [PARTIAL: Found ApprovalOperator but MISSED HITLAsyncGate (new in Airflow 3.1) - fetch docs for complete list]

  # ILIKE patterns WITHOUT explicit ApprovalOperator - simulates missing related operators
  - pattern: "(?i)OPERATOR.*LIKE.*%hitl%|OPERATOR.*LIKE.*%human.*loop%"
    response: |
      shape: (3, 4)
      | OPERATOR | DEPLOYMENT_COUNT | ORG_COUNT | TASK_RUN_COUNT |
      |----------|------------------|-----------|----------------|
      | HITLOperator | 15 | 8 | 1250 |
      | HITLBranchOperator | 10 | 5 | 890 |
      | HITLEntryOperator | 8 | 4 | 560 |
      [WARNING: ILIKE query missed ApprovalOperator - fetch docs first to discover all HITL operators]

  # Simpler HITL pattern - also returns incomplete results
  - pattern: "(?i)hitl|human.*loop"
    response: |
      shape: (3, 4)
      | OPERATOR | DEPLOYMENT_COUNT | ORG_COUNT | TASK_RUN_COUNT |
      |----------|------------------|-----------|----------------|
      | HITLOperator | 15 | 8 | 1250 |
      | HITLBranchOperator | 10 | 5 | 890 |
      | HITLEntryOperator | 8 | 4 | 560 |
      [WARNING: This query missed ApprovalOperator and ApprovalSensor which are part of HITL family]

  # Discovery query for Approval operators (if agent specifically searches for them)
  - pattern: "(?i)%approval%"
    response: |
      shape: (2, 4)
      | OPERATOR | DEPLOYMENT_COUNT | ORG_COUNT | TASK_RUN_COUNT |
      |----------|------------------|-----------|----------------|
      | ApprovalOperator | 12 | 7 | 980 |
      | ApprovalSensor | 6 | 3 | 340 |

  # Combined HITL family query
  - pattern: "OPERATOR.*IN.*HITLOperator.*ApprovalOperator"
    response: |
      shape: (5, 4)
      | OPERATOR | DEPLOYMENT_COUNT | ORG_COUNT | TASK_RUN_COUNT |
      |----------|------------------|-----------|----------------|
      | HITLOperator | 15 | 8 | 1250 |
      | HITLBranchOperator | 10 | 5 | 890 |
      | HITLEntryOperator | 8 | 4 | 560 |
      | ApprovalOperator | 12 | 7 | 980 |
      | ApprovalSensor | 6 | 3 | 340 |

  # Customer details query
  - pattern: "ORG_NAME|ORGANIZATION"
    response: |
      shape: (12, 3)
      | ORG_NAME | OPERATOR | TASK_RUN_COUNT |
      |----------|----------|----------------|
      | Acme Corp | HITLOperator | 450 |
      | Beta Industries | ApprovalOperator | 320 |
      | Cloud Systems | HITLBranchOperator | 280 |
      | Data Dynamics | HITLOperator | 240 |
      | Enterprise AI | ApprovalOperator | 210 |
      | FinTech Pro | HITLEntryOperator | 180 |
      | Global Analytics | HITLOperator | 160 |
      | Health Data Inc | ApprovalSensor | 140 |
      | InnoTech | HITLBranchOperator | 130 |
      | Jupiter Systems | ApprovalOperator | 120 |
      | Knowledge Base | HITLOperator | 110 |
      | Logic Labs | HITLEntryOperator | 100 |

  # Snowflake operator query
  - pattern: "OPERATOR.*ILIKE.*%snowflake%"
    response: |
      shape: (4, 4)
      | OPERATOR | DEPLOYMENT_COUNT | ORG_COUNT | TASK_RUN_COUNT |
      |----------|------------------|-----------|----------------|
      | SnowflakeOperator | 45 | 32 | 15600 |
      | SnowflakeSensor | 28 | 18 | 8900 |
      | SnowflakeToS3Operator | 12 | 8 | 3400 |
      | S3ToSnowflakeOperator | 15 | 10 | 4200 |

  # dbt/Cosmos operator query
  - pattern: "OPERATOR.*ILIKE.*%dbt%|OPERATOR.*ILIKE.*%cosmos%"
    response: |
      shape: (3, 4)
      | OPERATOR | DEPLOYMENT_COUNT | ORG_COUNT | TASK_RUN_COUNT |
      |----------|------------------|-----------|----------------|
      | DbtRunOperator | 38 | 25 | 12400 |
      | DbtTestOperator | 35 | 24 | 11800 |
      | DbtSeedOperator | 20 | 15 | 6500 |

  # Distinct operators query
  - pattern: "(?i)DISTINCT.*OPERATOR"
    response: |
      shape: (8, 1)
      | OPERATOR |
      |----------|
      | PythonOperator |
      | BashOperator |
      | HITLOperator |
      | ApprovalOperator |
      | S3ToSnowflakeOperator |
      | SnowflakeOperator |
      | DbtRunOperator |
      | EmptyOperator |

  # Default catch-all for unknown queries - returns empty result
  - pattern: "SELECT"
    response: |
      shape: (0, 1)
      | RESULT |
      |--------|
      (0 rows returned - no matching data for this query)

list_schemas:
  - pattern: ".*"
    response: |
      {
        "schemas": [
          {"database": "HQ", "schema": "MODEL_ASTRO", "table_count": 45},
          {"database": "HQ", "schema": "RAW_ASTRO", "table_count": 120},
          {"database": "HQ", "schema": "METRICS", "table_count": 25}
        ]
      }

list_tables:
  - pattern: "HQ.MODEL_ASTRO"
    response: |
      {
        "tables": [
          {"name": "TASK_RUNS", "row_count": 6500000000, "type": "TABLE"},
          {"name": "DEPLOYMENTS", "row_count": 15000, "type": "TABLE"},
          {"name": "ORGANIZATIONS", "row_count": 8500, "type": "TABLE"},
          {"name": "DEPLOYMENT_OPERATOR_ACTIVITY", "row_count": 2500000, "type": "TABLE"}
        ]
      }

get_tables_info:
  - pattern: "TASK_RUNS"
    response: |
      {
        "TASK_RUNS": {
          "columns": [
            {"name": "TASK_RUN_ID", "type": "VARCHAR", "nullable": false},
            {"name": "DEPLOYMENT_ID", "type": "VARCHAR", "nullable": false},
            {"name": "ORG_ID", "type": "VARCHAR", "nullable": false},
            {"name": "OPERATOR", "type": "VARCHAR", "nullable": true},
            {"name": "START_TS", "type": "TIMESTAMP_NTZ", "nullable": true},
            {"name": "END_TS", "type": "TIMESTAMP_NTZ", "nullable": true},
            {"name": "STATE", "type": "VARCHAR", "nullable": true}
          ],
          "row_count": 6500000000,
          "comment": "All task run executions across Astro platform"
        }
      }

  - pattern: "DEPLOYMENT_OPERATOR_ACTIVITY"
    response: |
      {
        "DEPLOYMENT_OPERATOR_ACTIVITY": {
          "columns": [
            {"name": "DEPLOYMENT_ID", "type": "VARCHAR", "nullable": false},
            {"name": "ORG_ID", "type": "VARCHAR", "nullable": false},
            {"name": "OPERATOR", "type": "VARCHAR", "nullable": false},
            {"name": "FIRST_SEEN", "type": "TIMESTAMP_NTZ", "nullable": true},
            {"name": "LAST_SEEN", "type": "TIMESTAMP_NTZ", "nullable": true},
            {"name": "TASK_RUN_COUNT", "type": "NUMBER", "nullable": true}
          ],
          "row_count": 2500000,
          "comment": "Pre-aggregated operator activity per deployment"
        }
      }
